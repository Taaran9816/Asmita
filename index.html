<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asmita Store</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<style>
  :root {
    --cream:#faf7f2; --dark:#1a1208; --rust:#c45c2a; --gold:#d4a843;
    --sage:#7a8c6e; --warm-gray:#9e9087; --card-bg:#fff9f3;
    --esewa:#60BB46; --esewa-dark:#3d8a2a;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{font-family:'DM Sans',sans-serif;background:var(--cream);color:var(--dark);min-height:100vh;}
  header{background:var(--dark);color:var(--cream);padding:0 2rem;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;height:70px;box-shadow:0 2px 20px rgba(0,0,0,0.3);}
  .logo{font-family:'Playfair Display',serif;font-size:1.8rem;letter-spacing:0.05em;color:var(--gold);}
  .logo span{font-style:italic;color:var(--cream);font-size:0.9rem;display:block;letter-spacing:0.25em;font-family:'DM Sans',sans-serif;font-weight:300;text-transform:uppercase;margin-top:-6px;}
  nav{display:flex;gap:2rem;align-items:center;}
  nav a{color:var(--cream);text-decoration:none;font-size:0.85rem;letter-spacing:0.1em;text-transform:uppercase;opacity:0.75;transition:opacity 0.2s;}
  nav a:hover{opacity:1;}
  .cart-btn{background:var(--rust);color:white;border:none;padding:0.5rem 1.2rem;border-radius:30px;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:0.85rem;display:flex;align-items:center;gap:0.5rem;transition:background 0.2s,transform 0.1s;}
  .cart-btn:hover{background:#a84d22;transform:scale(1.03);}
  .cart-count{background:var(--gold);color:var(--dark);border-radius:50%;width:20px;height:20px;font-size:0.75rem;font-weight:700;display:flex;align-items:center;justify-content:center;}
  .hero{background:linear-gradient(135deg,var(--dark) 0%,#2e1f0a 60%,#4a2e12 100%);color:var(--cream);padding:5rem 3rem;display:flex;align-items:center;justify-content:space-between;overflow:hidden;position:relative;}
  .hero::before{content:'';position:absolute;right:-100px;top:-100px;width:500px;height:500px;border-radius:50%;background:radial-gradient(circle,rgba(212,168,67,0.15),transparent 70%);}
  .hero-text h1{font-family:'Playfair Display',serif;font-size:clamp(2.5rem,5vw,4.5rem);line-height:1.1;max-width:550px;}
  .hero-text h1 em{font-style:italic;color:var(--gold);}
  .hero-text p{margin-top:1rem;opacity:0.7;max-width:420px;line-height:1.7;font-size:1rem;}
  .hero-cta{margin-top:2rem;display:inline-block;background:var(--gold);color:var(--dark);padding:0.85rem 2.2rem;border-radius:40px;font-weight:500;cursor:pointer;border:none;font-family:'DM Sans',sans-serif;font-size:0.95rem;transition:transform 0.2s,box-shadow 0.2s;}
  .hero-cta:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(212,168,67,0.4);}
  .hero-badge{background:rgba(255,255,255,0.08);border:1px solid rgba(212,168,67,0.3);border-radius:20px;padding:2rem 2.5rem;text-align:center;backdrop-filter:blur(10px);}
  .hero-badge .big{font-family:'Playfair Display',serif;font-size:3rem;color:var(--gold);}
  .hero-badge small{display:block;opacity:0.6;font-size:0.8rem;letter-spacing:0.15em;text-transform:uppercase;margin-top:0.25rem;}
  .filter-bar{padding:1.5rem 2rem;background:white;border-bottom:1px solid rgba(0,0,0,0.07);display:flex;gap:1rem;align-items:center;flex-wrap:wrap;}
  .filter-bar span{font-size:0.8rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--warm-gray);margin-right:0.5rem;}
  .filter-btn{padding:0.4rem 1.1rem;border-radius:20px;border:1.5px solid rgba(0,0,0,0.15);background:transparent;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:0.85rem;transition:all 0.2s;color:var(--dark);}
  .filter-btn:hover,.filter-btn.active{background:var(--rust);border-color:var(--rust);color:white;}
  .search-box{margin-left:auto;display:flex;align-items:center;border:1.5px solid rgba(0,0,0,0.15);border-radius:25px;padding:0.35rem 1rem;gap:0.5rem;}
  .search-box input{border:none;outline:none;font-family:'DM Sans',sans-serif;font-size:0.85rem;background:transparent;width:180px;color:var(--dark);}
  .section-title{font-family:'Playfair Display',serif;font-size:2rem;padding:2.5rem 2rem 0.5rem;}
  .section-sub{padding:0 2rem 1.5rem;color:var(--warm-gray);font-size:0.9rem;}
  .products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:1.5rem;padding:0 2rem 3rem;}
  .product-card{background:var(--card-bg);border-radius:16px;overflow:hidden;border:1px solid rgba(0,0,0,0.06);transition:transform 0.25s,box-shadow 0.25s;cursor:pointer;animation:fadeUp 0.5s ease both;}
  .product-card:hover{transform:translateY(-6px);box-shadow:0 20px 40px rgba(0,0,0,0.1);}
  @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
  .product-img{width:100%;height:220px;display:flex;align-items:center;justify-content:center;font-size:5rem;background:linear-gradient(145deg,#f0e8dc,#e8ddd0);position:relative;}
  .badge{position:absolute;top:12px;left:12px;background:var(--rust);color:white;font-size:0.7rem;font-weight:500;letter-spacing:0.08em;text-transform:uppercase;padding:3px 10px;border-radius:20px;z-index:2;}
  .badge.new{background:var(--sage);}
  .product-info{padding:1.2rem;}
  .product-category{font-size:0.7rem;text-transform:uppercase;letter-spacing:0.15em;color:var(--warm-gray);margin-bottom:0.4rem;}
  .product-name{font-family:'Playfair Display',serif;font-size:1.1rem;margin-bottom:0.3rem;line-height:1.3;}
  .product-desc{font-size:0.8rem;color:var(--warm-gray);line-height:1.5;margin-bottom:1rem;}
  .product-footer{display:flex;align-items:center;justify-content:space-between;}
  .price{font-size:1.2rem;font-weight:500;color:var(--rust);}
  .price .original{font-size:0.8rem;color:var(--warm-gray);text-decoration:line-through;margin-left:0.3rem;font-weight:400;}
  .add-btn{background:var(--dark);color:var(--cream);border:none;border-radius:25px;padding:0.45rem 1rem;font-size:0.8rem;cursor:pointer;font-family:'DM Sans',sans-serif;transition:background 0.2s,transform 0.1s;}
  .add-btn:hover{background:var(--rust);transform:scale(1.05);}
  .add-btn.added{background:var(--sage);}
  .cart-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:200;opacity:0;pointer-events:none;transition:opacity 0.3s;}
  .cart-overlay.open{opacity:1;pointer-events:all;}
  .cart-sidebar{position:fixed;right:-420px;top:0;width:min(420px,100vw);height:100vh;background:var(--cream);z-index:201;transition:right 0.35s cubic-bezier(0.25,0.46,0.45,0.94);display:flex;flex-direction:column;box-shadow:-10px 0 40px rgba(0,0,0,0.2);}
  .cart-sidebar.open{right:0;}
  .cart-header{background:var(--dark);color:var(--cream);padding:1.5rem;display:flex;align-items:center;justify-content:space-between;}
  .cart-header h2{font-family:'Playfair Display',serif;font-size:1.4rem;}
  .close-btn{background:none;border:none;color:var(--cream);cursor:pointer;font-size:1.5rem;opacity:0.7;}
  .close-btn:hover{opacity:1;}
  .cart-items{flex:1;overflow-y:auto;padding:1rem;}
  .cart-item{display:flex;align-items:center;gap:1rem;padding:1rem;background:white;border-radius:12px;margin-bottom:0.75rem;border:1px solid rgba(0,0,0,0.06);}
  .cart-item-emoji{font-size:2.5rem;width:60px;text-align:center;}
  .cart-item-info{flex:1;}
  .cart-item-name{font-family:'Playfair Display',serif;font-size:0.95rem;}
  .cart-item-price{color:var(--rust);font-size:0.9rem;margin-top:0.2rem;}
  .cart-item-qty{display:flex;align-items:center;gap:0.5rem;margin-top:0.5rem;}
  .qty-btn{width:26px;height:26px;border-radius:50%;border:1.5px solid rgba(0,0,0,0.15);background:transparent;cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;transition:all 0.15s;}
  .qty-btn:hover{background:var(--dark);color:white;border-color:var(--dark);}
  .qty-num{font-size:0.9rem;font-weight:500;min-width:20px;text-align:center;}
  .remove-btn{background:none;border:none;cursor:pointer;color:var(--warm-gray);font-size:1.2rem;transition:color 0.15s;}
  .remove-btn:hover{color:var(--rust);}
  .empty-cart{text-align:center;padding:3rem 1rem;color:var(--warm-gray);}
  .empty-cart .icon{font-size:4rem;margin-bottom:1rem;}
  .empty-cart p{font-family:'Playfair Display',serif;font-size:1.1rem;}
  .cart-footer{padding:1.5rem;background:white;border-top:1px solid rgba(0,0,0,0.08);}
  .cart-total{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;}
  .cart-total span{font-size:0.9rem;color:var(--warm-gray);}
  .cart-total strong{font-family:'Playfair Display',serif;font-size:1.5rem;}
  .checkout-btn{width:100%;background:var(--rust);color:white;border:none;padding:1rem;border-radius:12px;font-family:'DM Sans',sans-serif;font-size:1rem;font-weight:500;cursor:pointer;transition:background 0.2s;letter-spacing:0.05em;}
  .checkout-btn:hover{background:#a84d22;}
  .checkout-btn:disabled{background:var(--warm-gray);cursor:not-allowed;}
  .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:300;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.3s;}
  .modal-overlay.open{opacity:1;pointer-events:all;}
  .modal{background:var(--cream);border-radius:20px;max-width:480px;width:90%;overflow:hidden;transform:scale(0.9);transition:transform 0.3s;}
  .modal-overlay.open .modal{transform:scale(1);}
  .modal-img{height:220px;display:flex;align-items:center;justify-content:center;font-size:6rem;background:linear-gradient(145deg,#f0e8dc,#e8ddd0);}
  .modal-body{padding:1.5rem;}
  .modal-body h2{font-family:'Playfair Display',serif;font-size:1.5rem;margin-bottom:0.5rem;}
  .modal-body p{color:var(--warm-gray);line-height:1.7;margin-bottom:1rem;}
  .modal-actions{display:flex;gap:1rem;}
  .modal-close-btn{flex:1;padding:0.75rem;border:1.5px solid rgba(0,0,0,0.15);background:transparent;border-radius:10px;cursor:pointer;font-family:'DM Sans',sans-serif;}
  .modal-add-btn{flex:2;padding:0.75rem;background:var(--rust);color:white;border:none;border-radius:10px;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:0.95rem;transition:background 0.2s;}
  .modal-add-btn:hover{background:#a84d22;}
  .toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(100px);background:var(--dark);color:var(--cream);padding:0.8rem 1.8rem;border-radius:30px;font-size:0.9rem;z-index:9999;transition:transform 0.35s cubic-bezier(0.25,0.46,0.45,0.94);white-space:nowrap;}
  .toast.show{transform:translateX(-50%) translateY(0);}
  /* PAYMENT PAGE */
  #paymentPage{display:none;position:fixed;inset:0;z-index:500;background:var(--cream);overflow-y:auto;}
  .pay-header{padding:1.1rem 1.5rem;display:flex;align-items:center;gap:1rem;}
  .pay-back{background:none;border:none;cursor:pointer;font-size:1.4rem;opacity:0.75;transition:opacity 0.2s;line-height:1;}
  .pay-back:hover{opacity:1;}
  .pay-progress{display:flex;border-radius:30px;overflow:hidden;background:#e8e0d8;margin-bottom:1.5rem;}
  .pay-step{flex:1;padding:0.4rem;text-align:center;font-size:0.72rem;color:var(--warm-gray);}
  .pay-step.active{background:var(--rust);color:white;font-weight:600;}
  .pay-step.done{background:#a0c89a;color:white;}
  .pay-step.done-green{background:var(--esewa);color:white;}
  .pay-card{background:white;border-radius:16px;padding:1.5rem;border:1px solid rgba(0,0,0,0.07);margin-bottom:1.5rem;}
  .pay-label{font-size:0.78rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--warm-gray);display:block;margin-bottom:0.35rem;}
  .pay-input{width:100%;padding:0.75rem 1rem;border:1.5px solid rgba(0,0,0,0.12);border-radius:10px;font-family:'DM Sans',sans-serif;font-size:0.9rem;outline:none;transition:border 0.2s;background:white;color:var(--dark);}
  .pay-input:focus{border-color:var(--rust);}
  .pay-btn{width:100%;padding:1rem;border:none;border-radius:12px;font-family:'DM Sans',sans-serif;font-size:1rem;font-weight:600;cursor:pointer;letter-spacing:0.05em;transition:opacity 0.2s;}
  .pay-btn:hover{opacity:0.88;}
  .upload-zone{border:2.5px dashed rgba(96,187,70,0.4);border-radius:14px;padding:2rem;text-align:center;cursor:pointer;transition:all 0.25s;background:#f8fff6;position:relative;overflow:hidden;}
  .upload-zone:hover,.upload-zone.dragover{border-color:var(--esewa);background:#edfaeb;transform:scale(1.01);}
  .upload-zone input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
  .upload-preview{width:100%;max-height:240px;object-fit:contain;border-radius:10px;margin-top:1rem;display:none;box-shadow:0 4px 15px rgba(0,0,0,0.1);}
  @keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
  .spinner{animation:spin 0.9s linear infinite;display:inline-block;}
  .receipt-row{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:0.6rem;font-size:0.85rem;}
  .receipt-row .rl{color:var(--warm-gray);flex-shrink:0;}
  .receipt-row .rr{text-align:right;max-width:210px;font-weight:500;}
  /* setup banner */
  .setup-banner{background:#1a1208;color:var(--cream);padding:0.85rem 2rem;display:flex;align-items:center;gap:1rem;font-size:0.83rem;flex-wrap:wrap;}
  .setup-banner strong{color:var(--gold);}
  .setup-banner a{color:var(--gold);cursor:pointer;}
  .setup-banner.active{background:linear-gradient(135deg,var(--esewa),var(--esewa-dark));}
  .setup-banner.active strong{color:white;}
  /* setup modal */
  #setupModal{display:none;position:fixed;inset:0;z-index:600;background:rgba(0,0,0,0.7);align-items:center;justify-content:center;padding:1rem;}
  #setupModal.open{display:flex;}
  .setup-inner{background:white;border-radius:20px;max-width:540px;width:100%;max-height:90vh;overflow-y:auto;padding:2rem;}
  footer{background:var(--dark);color:rgba(255,255,255,0.5);text-align:center;padding:2rem;font-size:0.85rem;}
  footer strong{color:var(--gold);}
</style>
</head>
<body>

<!-- Setup Banner -->

<div class="setup-banner active" id="setupBanner">
  <span>‚úÖ</span>
  <span><strong>Email Notifications Active!</strong> Orders will be sent to Asmita981698@gmail.com</span>
  <span id="emailBadge" style="background:white;color:var(--esewa-dark);padding:2px 10px;border-radius:20px;font-size:0.75rem;font-weight:600;margin-left:auto;">‚úì READY</span>
  <button onclick="document.getElementById('setupBanner').style.display='none'" style="background:none;border:none;color:var(--cream);cursor:pointer;margin-left:0.5rem;opacity:0.5;font-size:1.3rem;line-height:1;">‚úï</button>
</div>

<header>
  <div class="logo">Asmita<span>Curated Collection</span></div>
  <nav><a href="#">Home</a><a href="#">New Arrivals</a><a href="#">Sale</a></nav>
  <button class="cart-btn" onclick="toggleCart()">üõçÔ∏è Cart <div class="cart-count" id="cartCount">0</div></button>
</header>

<section class="hero">
  <div class="hero-text">
    <h1>Discover <em>Timeless</em><br>Style & Elegance</h1>
    <p>Curated collections of premium products ‚Äî crafted with love, delivered with care.</p>
    <button class="hero-cta" onclick="document.querySelector('.products-grid').scrollIntoView({behavior:'smooth'})">Explore Collection ‚Üì</button>
  </div>
  <div class="hero-badge"><div class="big">200+</div><small>Happy Customers</small></div>
</section>

<div class="filter-bar">
  <span>Filter:</span>
  <button class="filter-btn active" onclick="filterProducts('all',this)">All</button>
  <button class="filter-btn" onclick="filterProducts('fashion',this)">Fashion</button>
  <button class="filter-btn" onclick="filterProducts('beauty',this)">Beauty</button>
  <button class="filter-btn" onclick="filterProducts('home',this)">Home</button>
  <button class="filter-btn" onclick="filterProducts('accessories',this)">Accessories</button>
  <div class="search-box">
    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
    <input type="text" id="searchInput" placeholder="Search products..." oninput="handleSearch()">
  </div>
</div>

<h2 class="section-title">Our Collection</h2>
<p class="section-sub">Handpicked products just for you</p>
<div class="products-grid" id="productsGrid"></div>

<!-- Cart -->

<div class="cart-overlay" id="cartOverlay" onclick="toggleCart()"></div>
<div class="cart-sidebar" id="cartSidebar">
  <div class="cart-header"><h2>Your Cart üõçÔ∏è</h2><button class="close-btn" onclick="toggleCart()">‚úï</button></div>
  <div class="cart-items" id="cartItems"></div>
  <div class="cart-footer">
    <div class="cart-total"><span>Total Amount</span><strong id="cartTotal">Rs. 0</strong></div>
    <button class="checkout-btn" id="checkoutBtn" onclick="checkout()" disabled>Proceed to Checkout ‚Üí</button>
  </div>
</div>

<!-- Product Modal -->

<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
  <div class="modal">
    <div class="modal-img" id="modalImg"></div>
    <div class="modal-body">
      <div class="product-category" id="modalCat"></div>
      <h2 id="modalName"></h2>
      <p id="modalDesc"></p>
      <div style="margin-bottom:1.2rem"><span class="price" id="modalPrice"></span></div>
      <div class="modal-actions">
        <button class="modal-close-btn" onclick="document.getElementById('modalOverlay').classList.remove('open')">Close</button>
        <button class="modal-add-btn" id="modalAddBtn">Add to Cart üõí</button>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- ====== PAYMENT PAGE ====== -->

<div id="paymentPage">

  <!-- STEP 1: Details -->

  <div id="stepInfo">
    <div class="pay-header" style="background:var(--dark);color:var(--cream);">
      <button class="pay-back" onclick="closePayment()" style="color:var(--cream);">‚Üê</button>
      <div style="font-family:'Playfair Display',serif;font-size:1.2rem;color:var(--gold);">Asmita Store</div>
      <div style="margin-left:auto;font-size:0.78rem;opacity:0.6;">Step 1 of 3</div>
    </div>
    <div style="max-width:560px;margin:2rem auto;padding:0 1.5rem;">
      <div class="pay-progress">
        <div class="pay-step active">‚ë† Your Details</div>
        <div class="pay-step">‚ë° Send via eSewa</div>
        <div class="pay-step">‚ë¢ Upload Proof</div>
      </div>
      <!-- Order Summary -->
      <div class="pay-card">
        <div style="font-family:'Playfair Display',serif;font-size:1.1rem;margin-bottom:1rem;">üßæ Order Summary</div>
        <div id="payOrderItems" style="font-size:0.85rem;"></div>
        <div style="border-top:1px dashed rgba(0,0,0,0.1);margin-top:1rem;padding-top:1rem;display:flex;justify-content:space-between;align-items:center;">
          <span style="font-weight:500;">Total to Pay</span>
          <span id="payOrderTotal" style="font-family:'Playfair Display',serif;font-size:1.4rem;color:var(--rust);"></span>
        </div>
      </div>
      <!-- Customer Form -->
      <div class="pay-card">
        <div style="font-family:'Playfair Display',serif;font-size:1.1rem;margin-bottom:1.2rem;">üì¶ Delivery Information</div>
        <div style="display:flex;flex-direction:column;gap:1rem;">
          <div><label class="pay-label">Full Name *</label><input class="pay-input" id="custName" type="text" placeholder="Your full name"></div>
          <div><label class="pay-label">Phone Number *</label><input class="pay-input" id="custPhone" type="tel" placeholder="98XXXXXXXX"></div>
          <div><label class="pay-label">Delivery Address *</label><textarea class="pay-input" id="custAddress" placeholder="Street, City, District..." rows="2" style="resize:none;"></textarea></div>
          <div><label class="pay-label">Your Email (optional ‚Äî for your copy)</label><input class="pay-input" id="custEmail" type="email" placeholder="your@email.com"></div>
        </div>
        <button class="pay-btn" onclick="goToEsewa()" style="margin-top:1.5rem;background:var(--rust);color:white;">Continue to Payment ‚Üí</button>
      </div>
    </div>
  </div>

  <!-- STEP 2: eSewa Send Instructions -->

  <div id="stepEsewa" style="display:none;">
    <div class="pay-header" style="background:var(--esewa);color:white;">
      <button class="pay-back" onclick="showStep('Info')" style="color:white;">‚Üê</button>
      <div style="font-size:1.1rem;font-weight:700;">eSewa Payment</div>
      <div style="margin-left:auto;font-size:0.78rem;opacity:0.85;">Step 2 of 3</div>
    </div>
    <div style="max-width:520px;margin:0 auto;padding:1.5rem;">
      <div class="pay-progress">
        <div class="pay-step done">‚ë† Details ‚úì</div>
        <div class="pay-step active" style="background:var(--esewa);">‚ë° Send via eSewa</div>
        <div class="pay-step">‚ë¢ Upload Proof</div>
      </div>
      <div style="background:white;border-radius:20px;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,0.12);margin-bottom:1.5rem;">
        <!-- Green Header -->
        <div style="background:linear-gradient(135deg,var(--esewa),var(--esewa-dark));padding:1.8rem;text-align:center;color:white;">
          <div style="font-size:2.2rem;font-weight:900;letter-spacing:0.08em;">eSewa</div>
          <div style="font-size:0.8rem;opacity:0.85;margin-top:0.2rem;">Nepal's #1 Digital Wallet</div>
        </div>
        <div style="padding:1.5rem;">
          <!-- Send To Box -->
          <div style="background:#f0faf0;border:2px solid #c5e8c0;border-radius:14px;padding:1.1rem;margin-bottom:1.2rem;">
            <div style="font-size:0.72rem;text-transform:uppercase;letter-spacing:0.12em;color:var(--esewa-dark);margin-bottom:0.6rem;font-weight:700;">üì§ Send Money To</div>
            <div style="display:flex;align-items:center;gap:0.85rem;">
              <div style="width:48px;height:48px;background:linear-gradient(135deg,var(--esewa),var(--esewa-dark));border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:1.3rem;flex-shrink:0;">üè™</div>
              <div>
                <div style="font-weight:700;font-size:0.95rem;">Asmita Store</div>
                <div style="font-size:1.35rem;color:var(--esewa-dark);font-weight:800;font-family:monospace;letter-spacing:0.04em;" id="displayNumber">9816982027</div>
              </div>
              <button onclick="copyNumber()" id="copyBtn" style="margin-left:auto;background:var(--esewa);color:white;border:none;border-radius:8px;padding:0.4rem 0.9rem;font-size:0.75rem;cursor:pointer;font-family:'DM Sans',sans-serif;font-weight:600;">Copy</button>
            </div>
          </div>
          <!-- Amount -->
          <div style="text-align:center;padding:1.1rem 0;border:2px dashed rgba(96,187,70,0.35);border-radius:12px;margin-bottom:1.2rem;background:#fafffa;">
            <div style="font-size:0.72rem;color:var(--warm-gray);text-transform:uppercase;letter-spacing:0.1em;margin-bottom:0.3rem;">Amount to Send</div>
            <div id="esewaAmount" style="font-size:2.6rem;font-weight:800;color:var(--esewa-dark);font-family:'Playfair Display',serif;"></div>
            <div style="font-size:0.72rem;color:var(--warm-gray);margin-top:0.2rem;">Nepalese Rupees (NPR)</div>
          </div>
          <!-- Steps -->
          <div style="background:#fffbea;border:1px solid #f0e0a0;border-radius:12px;padding:1rem 1.2rem;margin-bottom:1.5rem;">
            <div style="font-weight:700;font-size:0.83rem;margin-bottom:0.6rem;color:#7a6a30;">üì± How to pay via eSewa:</div>
            <ol style="padding-left:1.2rem;font-size:0.81rem;line-height:2;color:#7a6a30;">
              <li>Open your <strong>eSewa app</strong></li>
              <li>Tap <strong>"Send Money"</strong></li>
              <li>Enter: <strong style="color:var(--esewa-dark);">9816982027</strong> <button onclick="copyNumber()" style="background:none;border:none;color:var(--esewa-dark);cursor:pointer;font-size:0.75rem;text-decoration:underline;font-family:'DM Sans',sans-serif;">copy</button></li>
              <li>Enter amount: <strong id="esewaAmountSmall" style="color:var(--esewa-dark);"></strong></li>
              <li>Add note: <strong>"Asmita Store Order"</strong></li>
              <li>Confirm & take a <strong>screenshot</strong> ‚úÖ</li>
            </ol>
          </div>
          <button class="pay-btn" onclick="showStep('Upload')" style="background:linear-gradient(135deg,var(--esewa),var(--esewa-dark));color:white;">
            ‚úÖ I've Sent the Payment ‚Äî Upload Screenshot ‚Üí
          </button>
        </div>
      </div>
      <div style="text-align:center;font-size:0.75rem;color:var(--warm-gray);">üîí Your order is confirmed only after screenshot verification by Asmita Store</div>
    </div>
  </div>

  <!-- STEP 3: Upload Screenshot -->

  <div id="stepUpload" style="display:none;">
    <div class="pay-header" style="background:var(--dark);color:var(--cream);">
      <button class="pay-back" onclick="showStep('Esewa')" style="color:var(--cream);">‚Üê</button>
      <div style="font-family:'Playfair Display',serif;font-size:1.1rem;color:var(--gold);">Upload Payment Proof</div>
      <div style="margin-left:auto;font-size:0.78rem;opacity:0.6;">Step 3 of 3</div>
    </div>
    <div style="max-width:520px;margin:0 auto;padding:1.5rem;">
      <div class="pay-progress">
        <div class="pay-step done">‚ë† Details ‚úì</div>
        <div class="pay-step done-green">‚ë° eSewa ‚úì</div>
        <div class="pay-step active">‚ë¢ Upload Proof</div>
      </div>
      <div class="pay-card">
        <div style="font-family:'Playfair Display',serif;font-size:1.1rem;margin-bottom:0.4rem;">üì∏ Upload Payment Screenshot</div>
        <div style="font-size:0.82rem;color:var(--warm-gray);margin-bottom:1.2rem;line-height:1.65;">Upload the screenshot from your eSewa app showing the successful payment. This confirms your order to Asmita Store.</div>
        <div class="upload-zone" id="uploadZone">
          <input type="file" id="screenshotInput" accept="image/*" onchange="handleFileSelect(this)">
          <div id="uploadPlaceholder">
            <div style="font-size:3rem;margin-bottom:0.75rem;">üì±</div>
            <div style="font-weight:600;margin-bottom:0.3rem;color:var(--dark);">Tap to upload screenshot</div>
            <div style="font-size:0.78rem;color:var(--warm-gray);">PNG, JPG or JPEG ¬∑ Max 5MB</div>
          </div>
          <img id="uploadPreview" class="upload-preview" alt="Payment proof">
        </div>
        <div id="fileNameDisplay" style="margin-top:0.6rem;font-size:0.82rem;color:var(--sage);display:none;">‚úÖ <span id="fileName"></span></div>
        <div style="margin-top:1.2rem;">
          <label class="pay-label">eSewa Transaction Reference (optional but helpful)</label>
          <input class="pay-input" id="txnRef" type="text" placeholder="e.g. 00ABC1234567" style="font-family:monospace;">
        </div>
        <button class="pay-btn" id="submitBtn" onclick="submitOrder()" style="margin-top:1.5rem;background:var(--rust);color:white;">
          üìß Submit Order & Notify Asmita Store
        </button>
      </div>
      <div style="background:#f0faf0;border:1px solid #c5e8c0;border-radius:12px;padding:1rem 1.2rem;font-size:0.8rem;color:#3d8a2a;display:flex;gap:0.75rem;align-items:flex-start;">
        <span style="font-size:1.2rem;flex-shrink:0;">üí°</span>
        <div>Once submitted, <strong>Asmita Store</strong> will receive a full order notification at <strong>Asmita981698@gmail.com</strong> including your details and screenshot confirmation. Order will be processed within 24 hours.</div>
      </div>
    </div>
  </div>

  <!-- STEP 4: Processing -->

  <div id="stepProcessing" style="display:none;text-align:center;padding:6rem 2rem;">
    <div class="spinner" style="font-size:4rem;">üìß</div>
    <div style="font-family:'Playfair Display',serif;font-size:1.5rem;margin-top:1.5rem;">Sending Order Notification...</div>
    <div style="color:var(--warm-gray);margin-top:0.5rem;font-size:0.9rem;">Emailing your order details to Asmita Store</div>
    <div style="background:#e8e0d8;border-radius:30px;height:8px;max-width:300px;margin:2rem auto 0;overflow:hidden;">
      <div id="progressBar" style="background:linear-gradient(90deg,var(--rust),var(--gold));height:100%;width:0%;border-radius:30px;transition:width 0.15s;"></div>
    </div>
  </div>

  <!-- STEP 5: Success -->

  <div id="stepSuccess" style="display:none;max-width:520px;margin:0 auto;padding:2rem 1.5rem;text-align:center;">
    <div style="width:90px;height:90px;background:linear-gradient(135deg,var(--esewa),var(--esewa-dark));border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2.5rem;margin:1rem auto 1.5rem;box-shadow:0 10px 30px rgba(96,187,70,0.35);">‚úì</div>
    <div style="font-family:'Playfair Display',serif;font-size:2rem;margin-bottom:0.5rem;">Order Placed! üéâ</div>
    <div style="color:var(--warm-gray);font-size:0.9rem;line-height:1.7;margin-bottom:0.75rem;">Your order has been submitted and Asmita Store has been notified.</div>
    <div id="emailStatusMsg" style="font-size:0.82rem;margin-bottom:2rem;padding:0.6rem 1.4rem;border-radius:20px;display:inline-block;"></div>
    <!-- Receipt -->
    <div class="pay-card" style="text-align:left;margin-bottom:1.5rem;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px dashed rgba(0,0,0,0.1);">
        <div style="font-family:'Playfair Display',serif;font-size:1.1rem;">üìã Order Receipt</div>
        <span style="background:#e6f9e0;color:var(--esewa-dark);font-size:0.72rem;padding:4px 12px;border-radius:20px;font-weight:700;">SUBMITTED ‚úì</span>
      </div>
      <div id="receiptContent"></div>
    </div>
    <div style="background:#f0faf0;border:1px solid #c5e8c0;border-radius:12px;padding:0.85rem 1.2rem;display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;text-align:left;">
      <span style="font-size:1.6rem;">üü¢</span>
      <div><div style="font-weight:600;color:var(--esewa-dark);">Paid via eSewa</div><div style="font-size:0.78rem;color:#5a9a52;">Sent to 9816982027 (Asmita Store)</div></div>
    </div>
    <div style="background:#fff8f0;border:1px solid rgba(196,92,42,0.2);border-radius:12px;padding:0.85rem 1.2rem;font-size:0.82rem;color:var(--rust);margin-bottom:1.5rem;text-align:left;">
      ‚è∞ <strong>What's next?</strong> Asmita Store will verify your payment and arrange delivery within 24 hours.
    </div>
    <button onclick="finishOrder()" class="pay-btn" style="background:var(--dark);color:var(--cream);">Continue Shopping üõçÔ∏è</button>
  </div>
</div>

<footer><p>¬© 2025 <strong>Asmita Store</strong> ¬∑ Made with ‚ù§Ô∏è ¬∑ Powered by EmailJS</p></footer>

<script>
// =========== EMAILJS CONFIG - CONFIGURED ===========
const EJS_PUB = 'oUoR8hah6dhIwmlvO';
const EJS_SVC = 'service_7yoealk';
const EJS_TPL = 'template_whpcqof';
const STORE_EMAIL = 'Asmita981698@gmail.com';

function initEJS() {
  // Wait for EmailJS library to load
  if (typeof emailjs === 'undefined') {
    console.warn('‚è≥ EmailJS library still loading, retrying in 500ms...');
    setTimeout(initEJS, 500);
    return;
  }
  
  try {
    emailjs.init({
      publicKey: EJS_PUB,
      blockHeadless: false
    });
    console.log('‚úÖ EmailJS initialized successfully with public key:', EJS_PUB.substring(0, 5) + '...');
  } catch(e) {
    console.error('‚ùå EmailJS init failed:', e.message || e);
  }
}

// =========== PRODUCTS ===========
const products = [
  {id:1,name:"Silk Kurta",emoji:"üëó",category:"fashion",price:1299,original:1799,desc:"Luxurious silk kurta with hand-embroidered detailing. Perfect for festive occasions.",badge:"Sale"},
  {id:2,name:"Gold Jhumkas",emoji:"üíõ",category:"accessories",price:849,original:null,desc:"Traditional gold-tone jhumka earrings with pearl drops. Handcrafted by artisans.",badge:"New"},
  {id:3,name:"Rose Face Serum",emoji:"üåπ",category:"beauty",price:699,original:899,desc:"Hydrating rose extract serum for glowing, radiant skin. Suitable for all skin types.",badge:"Sale"},
  {id:4,name:"Ethnic Tote Bag",emoji:"üëú",category:"accessories",price:1199,original:null,desc:"Handwoven cotton tote with traditional block print design. Spacious and sustainable.",badge:null},
  {id:5,name:"Sandalwood Diffuser",emoji:"üïØÔ∏è",category:"home",price:549,original:null,desc:"Elegant reed diffuser with authentic sandalwood fragrance.",badge:"New"},
  {id:6,name:"Embroidered Dupatta",emoji:"üß£",category:"fashion",price:899,original:1299,desc:"Chiffon dupatta with delicate zari embroidery along the borders.",badge:"Sale"},
  {id:7,name:"Mogra Perfume",emoji:"üå∏",category:"beauty",price:1099,original:null,desc:"Floral mogra fragrance inspired by traditional Indian gardens.",badge:null},
  {id:8,name:"Brass Diyas Set",emoji:"ü™î",category:"home",price:399,original:599,desc:"Set of 6 hand-polished brass diyas. Perfect for puja and festive decoration.",badge:"Sale"},
  {id:9,name:"Kundan Necklace",emoji:"üìø",category:"accessories",price:2499,original:3299,desc:"Statement kundan necklace with colorful meenakari work.",badge:"Sale"},
  {id:10,name:"Cotton Saree",emoji:"ü•ª",category:"fashion",price:1599,original:null,desc:"Soft handloom cotton saree with natural vegetable dye.",badge:"New"},
  {id:11,name:"Ubtan Face Mask",emoji:"üçØ",category:"beauty",price:349,original:null,desc:"Traditional ubtan face mask with turmeric, sandalwood and rose powder.",badge:null},
  {id:12,name:"Macram√© Wall Art",emoji:"üñºÔ∏è",category:"home",price:799,original:null,desc:"Handcrafted macram√© wall hanging with bohemian design.",badge:"New"},
];

let cart=[], currentFilter='all', currentSearch='', selectedProduct=null;
let screenshotBase64='', screenshotFileName='';

function renderProducts() {
  const grid = document.getElementById('productsGrid');
  const filtered = products.filter(p=>{
    const mc = currentFilter==='all'||p.category===currentFilter;
    const ms = p.name.toLowerCase().includes(currentSearch)||p.desc.toLowerCase().includes(currentSearch);
    return mc&&ms;
  });
  if (!filtered.length) { grid.innerHTML='<p style="grid-column:1/-1;text-align:center;padding:3rem;color:var(--warm-gray);font-family:Playfair Display,serif;font-size:1.2rem;">No products found üåø</p>'; return; }
  grid.innerHTML = filtered.map((p,i)=>`
    <div class="product-card" style="animation-delay:${i*0.07}s" onclick="openModal(${p.id})">
      <div class="product-img">${p.badge?`<div class="badge ${p.badge==='New'?'new':''}">${p.badge}</div>`:''}${p.emoji}</div>
      <div class="product-info">
        <div class="product-category">${p.category}</div>
        <div class="product-name">${p.name}</div>
        <div class="product-desc">${p.desc}</div>
        <div class="product-footer">
          <div class="price">Rs.${p.price.toLocaleString()}${p.original?`<span class="original">Rs.${p.original.toLocaleString()}</span>`:''}</div>
          <button class="add-btn ${isInCart(p.id)?'added':''}" onclick="event.stopPropagation();addToCart(${p.id},this)">${isInCart(p.id)?'‚úì Added':'+ Cart'}</button>
        </div>
      </div>
    </div>`).join('');
}
function isInCart(id){return cart.some(c=>c.id===id);}
function addToCart(id,btn){
  const p=products.find(x=>x.id===id);
  const ex=cart.find(c=>c.id===id);
  if(ex)ex.qty++; else cart.push({...p,qty:1});
  updateCart();
  if(btn){btn.textContent='‚úì Added';btn.classList.add('added');}
  showToast(`${p.emoji} ${p.name} added!`);
}
function updateCart(){
  const count=cart.reduce((s,c)=>s+c.qty,0);
  document.getElementById('cartCount').textContent=count;
  const total=cart.reduce((s,c)=>s+c.price*c.qty,0);
  document.getElementById('cartTotal').textContent='Rs.'+total.toLocaleString();
  document.getElementById('checkoutBtn').disabled=cart.length===0;
  const box=document.getElementById('cartItems');
  if(!cart.length){box.innerHTML=`<div class="empty-cart"><div class="icon">üõçÔ∏è</div><p>Your cart is empty</p></div>`;return;}
  box.innerHTML=cart.map(c=>`
    <div class="cart-item">
      <div class="cart-item-emoji">${c.emoji}</div>
      <div class="cart-item-info">
        <div class="cart-item-name">${c.name}</div>
        <div class="cart-item-price">Rs.${(c.price*c.qty).toLocaleString()}</div>
        <div class="cart-item-qty">
          <button class="qty-btn" onclick="changeQty(${c.id},-1)">‚àí</button>
          <span class="qty-num">${c.qty}</span>
          <button class="qty-btn" onclick="changeQty(${c.id},1)">+</button>
        </div>
      </div>
      <button class="remove-btn" onclick="removeFromCart(${c.id})">üóë</button>
    </div>`).join('');
}
function changeQty(id,d){const it=cart.find(c=>c.id===id);if(!it)return;it.qty+=d;if(it.qty<=0)removeFromCart(id);else updateCart();}
function removeFromCart(id){cart=cart.filter(c=>c.id!==id);updateCart();renderProducts();}
function toggleCart(){document.getElementById('cartSidebar').classList.toggle('open');document.getElementById('cartOverlay').classList.toggle('open');}
function filterProducts(cat,btn){currentFilter=cat;document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');renderProducts();}
function handleSearch(){currentSearch=document.getElementById('searchInput').value.toLowerCase();renderProducts();}
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3000);}
function openModal(id){
  selectedProduct=products.find(p=>p.id===id);
  document.getElementById('modalImg').textContent=selectedProduct.emoji;
  document.getElementById('modalCat').textContent=selectedProduct.category;
  document.getElementById('modalName').textContent=selectedProduct.name;
  document.getElementById('modalDesc').textContent=selectedProduct.desc;
  document.getElementById('modalPrice').innerHTML=`Rs.${selectedProduct.price.toLocaleString()}${selectedProduct.original?` <span class="original" style="font-size:0.85rem;color:var(--warm-gray);text-decoration:line-through">Rs.${selectedProduct.original.toLocaleString()}</span>`:''}`;
  document.getElementById('modalAddBtn').onclick=()=>{addToCart(selectedProduct.id,null);renderProducts();document.getElementById('modalOverlay').classList.remove('open');};
  document.getElementById('modalOverlay').classList.add('open');
}
function closeModal(e){if(e.target===document.getElementById('modalOverlay'))document.getElementById('modalOverlay').classList.remove('open');}

// =========== CHECKOUT ===========
function checkout(){
  if(!cart.length)return;
  document.getElementById('cartSidebar').classList.remove('open');
  document.getElementById('cartOverlay').classList.remove('open');
  const total=cart.reduce((s,c)=>s+c.price*c.qty,0);
  document.getElementById('payOrderItems').innerHTML=cart.map(c=>`
    <div style="display:flex;justify-content:space-between;padding:0.4rem 0;border-bottom:1px solid rgba(0,0,0,0.05);"><span>${c.emoji} ${c.name} √ó ${c.qty}</span><span style="font-weight:500;">Rs.${(c.price*c.qty).toLocaleString()}</span></div>`).join('')+
    `<div style="display:flex;justify-content:space-between;padding:0.4rem 0;font-size:0.8rem;color:var(--warm-gray);"><span>Delivery</span><span style="color:var(--sage);">Free üéÅ</span></div>`;
  document.getElementById('payOrderTotal').textContent='Rs.'+total.toLocaleString();
  document.getElementById('esewaAmount').textContent='Rs. '+total.toLocaleString();
  document.getElementById('esewaAmountSmall').textContent='Rs. '+total.toLocaleString();
  screenshotBase64=''; screenshotFileName='';
  document.getElementById('uploadPreview').style.display='none';
  document.getElementById('uploadPlaceholder').style.display='block';
  document.getElementById('fileNameDisplay').style.display='none';
  if(document.getElementById('txnRef'))document.getElementById('txnRef').value='';
  showStep('Info');
  document.getElementById('paymentPage').style.display='block';
  document.body.style.overflow='hidden';
}
function showStep(s){
  ['Info','Esewa','Upload','Processing','Success'].forEach(n=>{const el=document.getElementById('step'+n);if(el)el.style.display='none';});
  const el=document.getElementById('step'+s);if(el)el.style.display='block';
  document.getElementById('paymentPage').scrollTop=0;
}
function closePayment(){document.getElementById('paymentPage').style.display='none';document.body.style.overflow='';}
function goToEsewa(){
  const name=document.getElementById('custName').value.trim();
  const phone=document.getElementById('custPhone').value.trim();
  const address=document.getElementById('custAddress').value.trim();
  if(!name||!phone||!address){showToast('‚ö†Ô∏è Please fill all required fields');return;}
  if(!/^\d{10}$/.test(phone.replace(/\s/g,''))){showToast('‚ö†Ô∏è Enter a valid 10-digit phone number');return;}
  showStep('Esewa');
}
function copyNumber(){
  navigator.clipboard.writeText('9816982027').then(()=>{
    document.getElementById('copyBtn').textContent='Copied!';
    setTimeout(()=>document.getElementById('copyBtn').textContent='Copy',2000);
  });
}

// =========== FILE UPLOAD ===========
function handleFileSelect(input){
  const file=input.files[0];
  if(!file)return;
  if(!file.type.startsWith('image/')){showToast('‚ö†Ô∏è Please select an image');return;}
  if(file.size>5*1024*1024){showToast('‚ö†Ô∏è Max 5MB image size');return;}
  screenshotFileName=file.name;
  const reader=new FileReader();
  reader.onload=e=>{
    screenshotBase64=e.target.result;
    const prev=document.getElementById('uploadPreview');
    prev.src=screenshotBase64; prev.style.display='block';
    document.getElementById('uploadPlaceholder').style.display='none';
    document.getElementById('fileName').textContent=file.name;
    document.getElementById('fileNameDisplay').style.display='block';
  };
  reader.readAsDataURL(file);
}
const uz=document.getElementById('uploadZone');
uz.addEventListener('dragover',e=>{e.preventDefault();uz.classList.add('dragover');});
uz.addEventListener('dragleave',()=>uz.classList.remove('dragover'));
uz.addEventListener('drop',e=>{
  e.preventDefault();uz.classList.remove('dragover');
  const file=e.dataTransfer.files[0];
  if(file){const inp=document.getElementById('screenshotInput');const dt=new DataTransfer();dt.items.add(file);inp.files=dt.files;handleFileSelect(inp);}
});

// =========== SUBMIT ORDER ===========
async function submitOrder(){
  if(!screenshotBase64){showToast('‚ö†Ô∏è Please upload your payment screenshot');return;}
  const name=document.getElementById('custName').value.trim();
  const phone=document.getElementById('custPhone').value.trim();
  const address=document.getElementById('custAddress').value.trim();
  const email=document.getElementById('custEmail').value.trim();
  const txnRef=(document.getElementById('txnRef').value||'').trim();
  const total=cart.reduce((s,c)=>s+c.price*c.qty,0);
  const orderId='AS-'+Date.now().toString().slice(-8);
  const orderTime=new Date().toLocaleString('en-NP');
  const itemsText=cart.map(c=>`${c.emoji} ${c.name} √ó ${c.qty} = Rs.${(c.price*c.qty).toLocaleString()}`).join('\n');
  const itemsHtml=cart.map(c=>`${c.emoji} ${c.name} √ó ${c.qty} = Rs.${(c.price*c.qty).toLocaleString()}`).join('<br>');

  const btn=document.getElementById('submitBtn');
  btn.textContent='‚è≥ Submitting...'; btn.disabled=true;
  showStep('Processing');
  let prog=0;
  const bar=document.getElementById('progressBar');
  const iv=setInterval(()=>{prog+=7;bar.style.width=Math.min(prog,88)+'%';},120);

  let emailSent=false, emailErr='';
  
  // Check if EmailJS is ready
  if (typeof emailjs === 'undefined') {
    emailErr = 'EmailJS library not loaded';
    console.error('‚ùå EmailJS library is not available');
  } else {
    try {
      console.log('üìß Attempting to send email with Service:', EJS_SVC, 'Template:', EJS_TPL);
      
      const response = await emailjs.send(EJS_SVC, EJS_TPL, {
        to_email: STORE_EMAIL,
        customer_name: name,
        customer_phone: phone,
        customer_address: address,
        customer_email: email||'Not provided',
        order_id: orderId,
        total_amount: 'Rs.'+total.toLocaleString(),
        txn_ref: txnRef||'Not provided',
        order_time: orderTime,
        order_items: itemsText,
        screenshot_note: screenshotBase64 ? '‚úÖ Customer uploaded payment screenshot' : '‚ö†Ô∏è No screenshot uploaded',
      });
      
      emailSent=true;
      console.log('‚úÖ Order email sent successfully!', response);
    } catch(e) {
      emailErr = e.text || e.message || 'Unknown error: ' + JSON.stringify(e);
      console.error('‚ùå Email send failed:', emailErr);
      
      // Save to local storage as backup
      try {
        const orders = JSON.parse(localStorage.getItem('asmita_orders') || '[]');
        orders.push({
          orderId, name, phone, address, email, txnRef, total, orderTime, itemsText,
          timestamp: new Date().toISOString()
        });
        localStorage.setItem('asmita_orders', JSON.stringify(orders));
        console.log('üìÅ Order saved locally as backup');
      } catch(e) {
        console.error('Failed to save backup:', e);
      }
    }
  }

  clearInterval(iv); bar.style.width='100%';
  setTimeout(()=>{
    document.getElementById('receiptContent').innerHTML=`
      <div class="receipt-row"><span class="rl">Order ID</span><span class="rr" style="font-family:monospace;">${orderId}</span></div>
      <div class="receipt-row"><span class="rl">Customer</span><span class="rr">${name}</span></div>
      <div class="receipt-row"><span class="rl">Phone</span><span class="rr">${phone}</span></div>
      <div class="receipt-row"><span class="rl">Delivery To</span><span class="rr">${address}</span></div>
      ${txnRef?`<div class="receipt-row"><span class="rl">eSewa Ref</span><span class="rr" style="font-family:monospace;">${txnRef}</span></div>`:''}
      <div class="receipt-row"><span class="rl">Date & Time</span><span class="rr">${orderTime}</span></div>
      <div style="margin:0.75rem 0;padding:0.75rem 0;border-top:1px dashed rgba(0,0,0,0.1);border-bottom:1px dashed rgba(0,0,0,0.1);font-size:0.82rem;color:var(--warm-gray);line-height:1.9;">${itemsHtml}</div>
      <div class="receipt-row" style="margin-top:0.5rem;"><span class="rl" style="font-weight:700;">Total Paid</span><span class="rr" style="font-family:'Playfair Display',serif;font-size:1.3rem;color:var(--esewa-dark);font-weight:700;">Rs.${total.toLocaleString()}</span></div>
      ${screenshotBase64?`<div style="margin-top:1rem;"><div style="font-size:0.75rem;color:var(--warm-gray);margin-bottom:0.5rem;text-transform:uppercase;letter-spacing:0.1em;">Payment Screenshot</div><img src="${screenshotBase64}" style="width:100%;max-height:180px;object-fit:contain;border-radius:8px;border:1px solid rgba(0,0,0,0.1);"></div>`:''}
    `;
    const sm=document.getElementById('emailStatusMsg');
    if(emailSent){
      sm.textContent='üìß Order email sent to Asmita981698@gmail.com ‚úì';
      sm.style.cssText='background:#d4edda;color:#155724;';
    } else {
      sm.textContent=`‚ùå Email failed: ${emailErr} ‚Äî You can manually send details to ${STORE_EMAIL}`;
      sm.style.cssText='background:#f8d7da;color:#721c24;';
    }
    showStep('Success');
    btn.textContent='üìß Submit Order & Notify Asmita Store'; btn.disabled=false;
  },500);
}

function finishOrder(){
  cart=[];updateCart();renderProducts();
  ['custName','custPhone','custAddress','custEmail','txnRef'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
  screenshotBase64='';
  closePayment();
  showToast('üéâ Thank you for your order!');
}

// Export orders from local storage
function exportOrders() {
  try {
    const orders = JSON.parse(localStorage.getItem('asmita_orders') || '[]');
    if (!orders.length) {
      alert('No orders saved yet');
      return;
    }
    const csv = 'Order ID,Customer Name,Phone,Address,Email,eSewa Ref,Total,Time\n' +
      orders.map(o => `"${o.orderId}","${o.name}","${o.phone}","${o.address}","${o.email}","${o.txnRef}","Rs.${o.total}","${o.orderTime}"`).join('\n');
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'asmita_orders_' + new Date().toISOString().slice(0,10) + '.csv';
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
  } catch(e) {
    console.error('Export failed:', e);
    alert('Failed to export orders');
  }
}

// Initialize
initEJS();
renderProducts();
updateCart();
</script>

</body>
</html>
